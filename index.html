<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Draft Lobby CMIM</title>

<!-- Tailwind CSS -->
<script src="https://cdn.tailwindcss.com"></script>

<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        cmim: '#22c55e',
        cmimDark: '#16a34a'
      }
    }
  }
}
</script>

<style>
body::before {
  content: "";
  position: fixed;
  inset: 0;
  background: url('cmim.png') center/cover no-repeat;
  opacity: 0.08;
  z-index: -1;
}
</style>
</head>

<body class="bg-zinc-950 text-zinc-100 min-h-screen flex flex-col">

<!-- Navbar -->
<nav class="bg-black/80 backdrop-blur border-b border-zinc-800 px-6 py-4 text-xl font-bold text-cmim shadow">
  CMIM • Draft Lobby
</nav>

<!-- Conteúdo -->
<main class="flex-1 max-w-6xl mx-auto px-4 py-8">

  <h1 class="text-3xl font-extrabold text-cmim mb-2 text-center">
    Lobby de Draft
  </h1>
  <p class="text-zinc-400 mb-8 text-center">
    Preencha os jogadores e escolha dois capitães
  </p>

  <!-- Players -->
  <div id="playerForm" class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8"></div>

  <!-- Ações -->
  <div class="text-center">
    <button
      id="startDraftBtn"
      class="bg-cmim hover:bg-cmimDark transition px-8 py-3 rounded-xl font-bold text-black shadow-lg">
      Iniciar Draft
    </button>
  </div>

  <!-- Links -->
  <div id="draftLinks" class="mt-8 text-center space-y-2"></div>

</main>

<!-- Footer -->
<footer class="bg-black/80 border-t border-zinc-800 text-center text-sm text-zinc-400 py-4">
  CMIM © 2025 • Todos os direitos reservados
</footer>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-app.js";
import { getFirestore, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.1.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyDBBBrCIRHYE4G4KpTf-GDY4gwWJUMhltI",
  authDomain: "selecao-3d8f3.firebaseapp.com",
  projectId: "selecao-3d8f3",
  storageBucket: "selecao-3d8f3.appspot.com",
  messagingSenderId: "1074353598922",
  appId: "1:1074353598922:web:7e6b6a130fd54397819f33"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let players = [];
const laneSlots = { top:2, jungle:2, mid:2, adc:2, support:2 };

const formDiv = document.getElementById("playerForm");

Object.keys(laneSlots).forEach(lane => {
  const card = document.createElement("div");
  card.className = "bg-zinc-900/80 border border-zinc-800 rounded-2xl p-5 shadow";

  card.innerHTML = `
    <h2 class="text-xl font-bold text-cmim mb-4">${lane.toUpperCase()}</h2>
  `;

  for (let i = 1; i <= laneSlots[lane]; i++) {
    const row = document.createElement("div");
    row.className = "flex flex-wrap gap-2 items-center mb-3";

    row.innerHTML = `
      <input
        id="${lane}-${i}-name"
        placeholder="Player ${i}"
        class="flex-1 bg-zinc-800 border border-zinc-700 rounded-lg px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-cmim">

      <select
        id="${lane}-${i}-tier"
        class="bg-zinc-800 border border-zinc-700 rounded-lg px-2 py-2 text-sm">
        <option>S</option>
        <option>A+</option>
        <option>A</option>
        <option>A-</option>
        <option>B</option>
        <option>C</option>
        <option>D</option>
        <option>E</option>
        <option>F</option>
      </select>

      <label class="flex items-center gap-1 text-xs text-cmim cursor-pointer">
        <input type="checkbox" name="captain" value="${lane}-${i}" class="accent-green-500">
        Capitão
      </label>
    `;

    card.appendChild(row);
  }

  formDiv.appendChild(card);
});

// Limite de capitães
document.querySelectorAll('input[name="captain"]').forEach(box => {
  box.addEventListener("change", () => {
    if (document.querySelectorAll('input[name="captain"]:checked').length > 2) {
      box.checked = false;
      alert("Só é permitido escolher 2 capitães!");
    }
  });
});

function collectPlayers() {
  players = [];
  let valid = true;

  Object.keys(laneSlots).forEach(lane => {
    for (let i = 1; i <= laneSlots[lane]; i++) {
      const name = document.getElementById(`${lane}-${i}-name`).value.trim();
      const tier = document.getElementById(`${lane}-${i}-tier`).value;
      if (!name) valid = false;
      players.push({ name, lane, tier });
    }
  });

  return valid;
}

function collectCaptains() {
  const checked = [...document.querySelectorAll('input[name="captain"]:checked')];
  if (checked.length !== 2) return null;

  return checked.map(c => {
    const [lane, i] = c.value.split("-");
    return document.getElementById(`${lane}-${i}-name`).value.trim();
  });
}

async function startDraft() {
  if (!collectPlayers()) return alert("Preencha todos os nomes!");
  const captains = collectCaptains();
  if (!captains) return alert("Escolha exatamente 2 capitães!");

  const tierOrder = {S:1,"A+":2,A:3,"A-":4,B:5,C:6,D:7,E:8,F:9};
  let [capA, capB] = captains.map(n => players.find(p => p.name === n));
  if (tierOrder[capA.tier] > tierOrder[capB.tier]) [capA, capB] = [capB, capA];

  const draftID = Math.random().toString(36).slice(2,10);

  await setDoc(doc(db, "drafts", draftID), {
    players,
    captains: [capA.name, capB.name],
    teams: {A:[], B:[]},
    currentPick: "A",
    started: false,
    createdAt: serverTimestamp()
  });

  draftLinks.innerHTML = `
    <p class="text-cmim font-bold mb-2">
      Capitães: ${capA.name} (A) × ${capB.name} (B)
    </p>
    <a class="block text-cmim underline" target="_blank" href="draft.html?draft=${draftID}&team=A">
      Entrar como Time A
    </a>
    <a class="block text-cmim underline" target="_blank" href="draft.html?draft=${draftID}&team=B">
      Entrar como Time B
    </a>
  `;
}

startDraftBtn.addEventListener("click", startDraft);
</script>

</body>
</html>
